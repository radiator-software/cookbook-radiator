# Copyright 2016-2018 Radiator Software Oy
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#  http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

#
# This configuration file is generated by Chef.
# All manual changes will be overwritten!
#
# You can find the template in:
# cookbook "radiator"
# template "etc/radiator/example-radius.cfg.erb"
#
# You should consider this file to be a starting point only
#

PidFile /var/run/radiator/radiator.pid
DbDir /etc/radiator

<%# @config is a variable, passed on from the radiator_configuration resource's config_variables property. -#%>
<%# print_value is a helper method, see: libraries/helpers.rb for the implementation. -#%>
<%= print_value(@config, 'Trace') -%>
<%= print_value(@config, 'LogDir')  -%>
LogFile
LogMicroseconds

<Log FILE>
<%# print_value does not print anything, if the value given is nil. -#%>
<%# .dig() is a Ruby Hash method that returns nil, if nothing is found. -#%>
<%# By providing indent and default values for print_value, you can control what is being rendered. -#%>
<%= print_value(@config.dig('Log', 'FILE'), 'Identifier', indent: 4, default: 'Log_FILE') -%>
<%= print_value(@config.dig('Log', 'FILE'), 'Trace', indent: 4, default: @config['Trace']) -%>
<%= print_value(@config.dig('Log', 'FILE'), 'Filename', indent: 4, default: '%L/radiator.log') -%>
</Log>

DisabledRuntimeChecks CVE-2014-0160

<%= print_value(@config, 'AuthPort') -%>
<%= print_value(@config, 'AcctPort') -%>

<%# Since this file is ERB, you can do Ruby things too. -#%>
<% if @config.key?('Client') -%>
<% @config['Client'].each do |name, client| -%>
<Client <%= name -%>>
    Secret <%= client['Secret'] %>
    Identifier <%= client['Identifier'] %>
</Client>
<% end -%>
<% end -%>

<%# You don't have to use Ruby or helper methods. Raw Radiator configuration is fine too. -#%>
<AuthBy INTERNAL>
    Identifier test-accept-all
    DefaultResult ACCEPT
</AuthBy>

<Handler Client-Identifier=chef>
    Identifier chef-test
    AuthBy test-accept-all
</Handler>
